# Give users some karma so that they can do call transctions.
[[TestCases]]
  RunCmd = "loom karma append-sources-for-user default:{{index $.AccountAddressList 1}} sms 5 -k {{index $.AccountPrivKeyPathList 0}}"
  Condition = "contains"
  Expected = [ "user's sources successfully updated" ]

[[TestCases]]
  RunCmd = "loom karma append-sources-for-user default:{{index $.AccountAddressList 2}} oauth 10 -k {{index $.AccountPrivKeyPathList 0}}"
  Condition = "contains"
  Expected = [ "user's sources successfully updated" ]

# Show coin for users. karma coin account is empty.
[[TestCases]]
  Dir = ""
  RunCmd = "example-cli call balance {{index $.AccountAddressList 0}}"
  Condition = "contains"
  Expected = ["100000000000000000000"]

[[TestCases]]
  Dir = ""
  RunCmd = "example-cli call balance {{index $.AccountAddressList 1}}"
  Condition = "contains"
  Expected = ["100000000000000000000"]

[[TestCases]]
  Dir = ""
  RunCmd = "example-cli call balance {{index $.AccountAddressList 2}}"
  Condition = "contains"
  Expected = ["100000000000000000000"]

[[TestCases]]
  Dir = ""
  RunCmd = "example-cli call balance karma"
  Condition = "contains"
  Expected = [ '"Value": 0' ]

# Approve kamra contract to be able to handle user's coin.
[[TestCases]]
  Dir = ""
  RunCmd = "example-cli call approve karma 1000 -k {{index $.AccountPrivKeyPathList 0}}"

[[TestCases]]
  Dir = ""
  RunCmd = "example-cli call approve karma 1000 -k {{index $.AccountPrivKeyPathList 1}}"

[[TestCases]]
  Dir = ""
  RunCmd = "example-cli call approve karma 1000 -k {{index $.AccountPrivKeyPathList 2}}"

# We did not give user 3 any karma.
[[TestCases]]
  Dir = ""
  RunCmd = "example-cli call approve karma 1000 -k {{index $.AccountPrivKeyPathList 3}}"
  Condition = "contains"
  #Expected = [ "origin has no karma" ]

# Deposite coin in karma contract.
[[TestCases]]
  RunCmd = "loom karma deposit-coin {{index $.AccountAddressList 1}} 10 -k {{index $.AccountPrivKeyPathList 0}}"
  Condition = "contains"
  Expected = [ "coin successfully deposited" ]

[[TestCases]]
  RunCmd = "loom karma deposit-coin {{index $.AccountAddressList 2}} 50 -k {{index $.AccountPrivKeyPathList 0}}"
  Condition = "contains"
  Expected = [ "coin successfully deposited" ]

# Show coin added to karma sources.
[[TestCases]]
  RunCmd = "loom karma get-total {{index $.AccountAddressList 1}}"
  Condition = "contains"
  Expected = [ '"Value": 15' ]

[[TestCases]]
  RunCmd = "loom karma get-total {{index $.AccountAddressList 2}}"
  Condition = "contains"
  Expected = [ '"Value": 80' ]

[[TestCases]]
  RunCmd = "loom karma get-total {{index $.AccountAddressList 3}}"
  Condition = "contains"
  Expected = [ '"Value": 0' ]

# coin removed from users 1 and 2 and added to karma.
[[TestCases]]
  Dir = ""
  RunCmd = "example-cli call balance {{index $.AccountAddressList 1}}"
  Condition = "contains"
  Expected = ["99999999999999999999999990"]

[[TestCases]]
  Dir = ""
  RunCmd = "example-cli call balance {{index $.AccountAddressList 2}}"
  Condition = "contains"
  Expected = ["99999999999999999999999950"]

[[TestCases]]
  Dir = ""
  RunCmd = "example-cli call balance karma"
  Condition = "contains"
  Expected = ["60"]

# Return some coin from the kamra contract to the user accounts.
[[TestCases]]
  RunCmd = "loom karma withdraw-coin {{index $.AccountAddressList 2}} 100 -k {{index $.AccountPrivKeyPathList 0}}"
  Expected = [ 'transferring coin from karma contract: sender balance is too low' ]

[[TestCases]]
  RunCmd = "loom karma withdraw-coin {{index $.AccountAddressList 2}} 4 -k {{index $.AccountPrivKeyPathList 2}}"
  Condition = "contains"
  Expected = [ "coin successfully withdrawn" ]

# Check user and karma coin levels to show withdrawal actuall happend.
[[TestCases]]
  RunCmd = "loom karma get-total {{index $.AccountAddressList 2}}"
  Condition = "contains"
  Expected = [ '"Value": 76' ]

[[TestCases]]
  Dir = ""
  RunCmd = "example-cli call balance {{index $.AccountAddressList 2}}"
  Condition = "contains"
  Expected = ["99999999999999999999999954"]

[[TestCases]]
  Dir = ""
  RunCmd = "example-cli call balance karma"
  Condition = "contains"
  Expected = ["56"]
